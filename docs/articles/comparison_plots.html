<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparison Plots â€¢ qgert</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparison Plots">
<meta property="og:description" content="qgert">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qgert</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alternative_compare_plot.html">Alternative Creation Of Compare Plots</a>
    </li>
    <li>
      <a href="../articles/comparison_plot_report.html">Generate Comparison Plot Reports</a>
    </li>
    <li>
      <a href="../articles/comparison_plots.html">Comparison Plots</a>
    </li>
    <li>
      <a href="../articles/compile_list_ebvfiles.html">Compile The List Of EBV Files</a>
    </li>
    <li>
      <a href="../articles/gs_job_schedule.html">Scheduling Strategy For GS-Jobs</a>
    </li>
    <li>
      <a href="../articles/qgert_getting_started.html">Getting Started With QGERT</a>
    </li>
    <li>
      <a href="../articles/spin_bash_script.html">Spinning Bash Scripts</a>
    </li>
    <li>
      <a href="../articles/split_gsruns_sorted_rt.html">Split gsRuns According To Predicted Runtimes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pvrqualitasag/qgert/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparison Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pvrqualitasag/qgert/blob/master/vignettes/comparison_plots.Rmd"><code>vignettes/comparison_plots.Rmd</code></a></small>
      <div class="hidden name"><code>comparison_plots.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">qgert</span>)</pre></body></html></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In a comparison plot, the result of two subsequent analysis are compared by a scatter plot. In that plot the results of the current analysis are on the x-axis and the results of the previous analysis are on the y-axis. The resulting scatter plot should result in a cloud of points that is close to the <code>y = x</code> line in the first plotting quadrant. Any outlier point can give hints about potential problems in the analysis.</p>
<p>For a single routine analysis the comparison plots by itself might only be meaningful with a lot of expert knowledge. When showing the comparison plots of two subsequent analyses next to each other, it might be much easier to get an idea about the quality of the current routine analysis.</p>
</div>
<div id="comparison-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-plot" class="anchor"></a>Comparison Plot</h2>
<p>The creation of a single comparison plot is already implemented. The implementation uses a shell script (<code>stdfmtprogs/prog/compare.sh</code>) to prepare the data that are then shown in the comparison scatter plot. This script is called with specific input parameter for each evaluation via a specific wrapper script.</p>
<p>Although, the functionality is already available for creating the single plots, it might still be interesting to give a short outline about how a comparison plot is constructed. In principle, a comparison plot just needs two pieces of input. These consist of the two result files from the two subsequent analyses for which we want to compare the evaluation results. The basic ideas are shown with two small example datasets.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">s_current_result_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"current_results.txt"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'qgert'</span>)
<span class="no">s_previous_result_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"previous_results.txt"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'qgert'</span>)</pre></body></html></div>
<p>In a first step the two datasets must be read</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="no">tbl_current_result</span> <span class="kw">&lt;-</span> <span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">s_current_result_path</span>, <span class="kw">delim</span> <span class="kw">=</span> <span class="st">' '</span>)
<span class="no">tbl_current_result</span> <span class="kw">&lt;-</span> <span class="no">tbl_current_result</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">current.estimate</span> <span class="kw">=</span> <span class="no">estimate</span>)
<span class="co"># tbl_current_result</span></pre></body></html></div>
<p>The previous results</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">tbl_previous_result</span> <span class="kw">&lt;-</span> <span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">s_previous_result_path</span>, <span class="kw">delim</span> <span class="kw">=</span> <span class="st">' '</span>)
<span class="no">tbl_previous_result</span> <span class="kw">&lt;-</span> <span class="no">tbl_previous_result</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">previous.estimate</span> <span class="kw">=</span> <span class="no">estimate</span>)
<span class="co"># tbl_previous_result</span></pre></body></html></div>
<p>The quantity that is plotted can be found in the column entitled <code>estimate</code>. For each of the traits different plots should be produced.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">tbl_current_result</span>$<span class="no">trait</span>))
<span class="co">#&gt; [1] "nrk" "nrr" "raz" "vzk" "vzr"</span></pre></body></html></div>
<p>The data from the two tibbles are joined to be used for the plotting afterwards</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">tbl_plot_result</span> <span class="kw">&lt;-</span> <span class="no">tbl_current_result</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(<span class="no">tbl_previous_result</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"idaItb16"</span> <span class="kw">=</span> <span class="st">"idaItb16"</span>, <span class="st">"trait"</span> <span class="kw">=</span> <span class="st">"trait"</span>))
<span class="co"># tbl_plot_result</span></pre></body></html></div>
<p>For a single trait, we get</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">tbl_plot_nrk</span> <span class="kw">&lt;-</span> <span class="no">tbl_plot_result</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">trait</span> <span class="kw">==</span> <span class="st">'nrk'</span>)
<span class="co"># tbl_plot_nrk</span></pre></body></html></div>
<p>This can now be used to do a scatter plot</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">n_cor_current_prev</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">previous.estimate</span>, <span class="no">tbl_plot_nrk</span>$<span class="no">current.estimate</span>)
<span class="no">n_mean_previous</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">previous.estimate</span>)
<span class="no">n_sd_previous</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">previous.estimate</span>)
<span class="no">n_mean_current</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">current.estimate</span>)
<span class="no">n_sd_current</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">current.estimate</span>)
<span class="no">xrng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">current.estimate</span>)
<span class="no">x_pos_txt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">xrng</span>[<span class="fl">2</span>])
<span class="no">yrng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">tbl_plot_nrk</span>$<span class="no">previous.estimate</span>)
<span class="no">y_pos_txt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="no">yrng</span>[<span class="fl">1</span>]) + <span class="fl">0.5</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="no">tbl_plot_nrk</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">current.estimate</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">previous.estimate</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">'red'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="kw">label</span> <span class="kw">=</span> <span class="st">"Comparison Plot for NRK"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Correlation: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">n_cor_current_prev</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>))),
                <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x_pos_txt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_pos_txt</span> + <span class="fl">2</span>), <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Mean: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">n_mean_previous</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="st">' | '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">n_mean_current</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">1</span>))),
                <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x_pos_txt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_pos_txt</span> + <span class="fl">1</span>), <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'SD: '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">n_sd_previous</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="st">' | '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">n_sd_current</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">1</span>))),
                <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x_pos_txt</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_pos_txt</span>), <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="comparison_plots_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>These comparison plots are done for all traits that are in a result file. In general, a comparison plot requires as input the following components</p>
<ul>
<li>two datasets, one from the previous routine run and one from the current run.</li>
<li>the join variables for the two data sets that define how the two datasets are to be joined and</li>
<li>the filter criterion which defines what goes into one plot.</li>
</ul>
</div>
<div id="drill-down-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#drill-down-functionality" class="anchor"></a>Drill Down Functionality</h2>
<p>The points that are away from the <code>y=x</code> line are interesting in the sense that they can point to a potential problem in the evaluation. Hence it would be very interesting to have a drill-down functionality to select the points on the plot and to get more information about the data that is behind the given point.</p>
<p>One possible implementation of such a drill-down functionality is via the linked-brushing feature in a shiny app.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
